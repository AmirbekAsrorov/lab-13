#include <iostream>
#include <vector>
#include <string>
#include <optional>

using namespace std;

class HashMapDoubleHashing {
public:
    struct Entry {
        string key;
        int value;
        bool operator==(const Entry& other) const {
            return key == other.key && value == other.value;
        }
    };

    explicit HashMapDoubleHashing(int capacity = 17) : table(capacity), n(capacity), capacity(capacity) {}

    bool put(const string& key, int value) {
        for (int i = 0; i < n; ++i) {
            int idx = probeIndex(key, i);
            if (!table[idx].has_value() || table[idx] == AVAILABLE) {
                table[idx] = Entry{key, value};
                return true;
            } else if (table[idx]->key == key) {
                table[idx]->value = value;
                return true;
            }
        }
        return false;
    }

    bool find(const string& key, int& outValue) const {
        for (int i = 0; i < n; ++i) {
            int idx = probeIndex(key, i);
            if (!table[idx].has_value()) return false;
            if (table[idx] != AVAILABLE && table[idx]->key == key) {
                outValue = table[idx]->value;
                return true;
            }
        }
        return false;
    }

    bool erase(const string& key) {
        for (int i = 0; i < n; ++i) {
            int idx = probeIndex(key, i);
            if (!table[idx].has_value()) return false;
            if (table[idx] != AVAILABLE && table[idx]->key == key) {
                table[idx] = AVAILABLE;
                return true;
            }
        }
        return false;
    }

    void printTable() const {
        for (int i = 0; i < n; ++i) {
            if (!table[i].has_value()) cout << i << ": EMPTY\n";
            else if (table[i] == AVAILABLE) cout << i << ": AVAILABLE\n";
            else cout << i << ": " << table[i]->key << " -> " << table[i]->value << "\n";
        }
    }

private:
    vector<optional<Entry>> table;
    static Entry AVAILABLE;
    int n;
    int capacity;

    unsigned long long polynomialHash(const string& key) const {
        unsigned long long h = 0;
        for (char c : key) h = h * 31 + c;
        return h;
    }

    int h1(const string& key) const {
        return polynomialHash(key) % n;
    }

    int h2(const string& key) const {
        int res = (polynomialHash(key) % (n - 1)) + 1;
        return res == 0 ? 1 : res;
    }

    int probeIndex(const string& key, int i) const {
        return (h1(key) + i * h2(key)) % n;
    }
};

HashMapDoubleHashing::Entry HashMapDoubleHashing::AVAILABLE = {"", -1};

int main() {
    HashMapDoubleHashing map;
    int choice;
    string key;
    int value;

    while (true) {
        cout << "\n1. Insert\n2. Find\n3. Delete\n4. Print\n5. Exit\nChoice: ";
        cin >> choice;
        switch (choice) {
            case 1:
                cout << "Key: "; cin >> key;
                cout << "Value: "; cin >> value;
                map.put(key, value);
                break;
            case 2:
                cout << "Key: "; cin >> key;
                if (map.find(key, value)) cout << "Found: " << value << endl;
                else cout << "Not Found\n";
                break;
            case 3:
                cout << "Key: "; cin >> key;
                if (map.erase(key)) cout << "Deleted\n";
                else cout << "Not Found\n";
                break;
            case 4:
                map.printTable();
                break;
            case 5:
                return 0;
        }
    }
}
